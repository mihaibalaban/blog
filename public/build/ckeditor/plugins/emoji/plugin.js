!function(){var e=!1,t=CKEDITOR.tools.array,i=CKEDITOR.tools.htmlEncode,s=CKEDITOR.tools.createClass({$:function(e,t){var i=this.lang=e.lang.emoji,s=this;this.listeners=[],this.plugin=t,this.editor=e,this.groups=[{name:"people",sectionName:i.groups.people,svgId:"cke4-icon-emoji-2",position:{x:-21,y:0},items:[]},{name:"nature",sectionName:i.groups.nature,svgId:"cke4-icon-emoji-3",position:{x:-42,y:0},items:[]},{name:"food",sectionName:i.groups.food,svgId:"cke4-icon-emoji-4",position:{x:-63,y:0},items:[]},{name:"travel",sectionName:i.groups.travel,svgId:"cke4-icon-emoji-6",position:{x:-42,y:-21},items:[]},{name:"activities",sectionName:i.groups.activities,svgId:"cke4-icon-emoji-5",position:{x:-84,y:0},items:[]},{name:"objects",sectionName:i.groups.objects,svgId:"cke4-icon-emoji-7",position:{x:0,y:-21},items:[]},{name:"symbols",sectionName:i.groups.symbols,svgId:"cke4-icon-emoji-8",position:{x:-21,y:-21},items:[]},{name:"flags",sectionName:i.groups.flags,svgId:"cke4-icon-emoji-9",position:{x:-63,y:-21},items:[]}],this.elements={},e.ui.addToolbarGroup("emoji","insert"),e.ui.add("EmojiPanel",CKEDITOR.UI_PANELBUTTON,{label:"emoji",title:i.title,modes:{wysiwyg:1},editorFocus:0,toolbar:"insert",panel:{css:[CKEDITOR.skin.getPath("editor"),t.path+"skins/default.css"],attributes:{role:"listbox","aria-label":i.title},markFirst:!1},onBlock:function(t,i){var n=i.keys,o="rtl"===e.lang.dir;n[o?37:39]="next",n[40]="next",n[9]="next",n[o?39:37]="prev",n[38]="prev",n[CKEDITOR.SHIFT+9]="prev",n[32]="click",s.blockElement=i.element,s.emojiList=s.editor._.emoji.list,s.addEmojiToGroups(),i.element.getAscendant("html").addClass("cke_emoji"),i.element.getDocument().appendStyleSheet(CKEDITOR.getUrl(CKEDITOR.basePath+"contents.css")),i.element.addClass("cke_emoji-panel_block"),i.element.setHtml(s.createEmojiBlock()),i.element.removeAttribute("title"),t.element.addClass("cke_emoji-panel"),s.items=i._.getItems(),s.blockObject=i,s.elements.emojiItems=i.element.find(".cke_emoji-outer_emoji_block li > a"),s.elements.sectionHeaders=i.element.find(".cke_emoji-outer_emoji_block h2"),s.elements.input=i.element.findOne("input"),s.inputIndex=s.getItemIndex(s.items,s.elements.input),s.elements.emojiBlock=i.element.findOne(".cke_emoji-outer_emoji_block"),s.elements.navigationItems=i.element.find("nav li"),s.elements.statusIcon=i.element.findOne(".cke_emoji-status_icon"),s.elements.statusDescription=i.element.findOne("p.cke_emoji-status_description"),s.elements.statusName=i.element.findOne("p.cke_emoji-status_full_name"),s.elements.sections=i.element.find("section"),s.registerListeners()},onOpen:s.openReset()})},proto:{registerListeners:function(){t.forEach(this.listeners,(function(e){var i=e.listener,s=e.event,n=e.ctx||this;t.forEach(this.blockElement.find(e.selector).toArray(),(function(e){e.on(s,i,n)}))}),this)},createEmojiBlock:function(){var e=[];return e.push(this.createGroupsNavigation()),e.push(this.createSearchSection()),e.push(this.createEmojiListBlock()),e.push(this.createStatusBar()),'<div class="cke_emoji-inner_panel">'+e.join("")+"</div>"},createGroupsNavigation:function(){var e,s;return CKEDITOR.env.ie&&!CKEDITOR.env.edge?(s=CKEDITOR.getUrl(this.plugin.path+"assets/iconsall.png"),e=new CKEDITOR.template('<li class="cke_emoji-navigation_item" data-cke-emoji-group="{group}"><a href="#" draggable="false" _cke_focus="1" title="{name}"><span style="background-image:url('+s+');background-repeat:no-repeat;background-position:{positionX}px {positionY}px;"></span></a></li>'),s=t.reduce(this.groups,(function(t,s){return s.items.length?t+e.output({group:i(s.name),name:i(s.sectionName),positionX:s.position.x,positionY:s.position.y}):t}),"")):(s=CKEDITOR.getUrl(this.plugin.path+"assets/iconsall.svg"),s=CKEDITOR.env.safari?'xlink:href="'+s+'#{svgId}"':'href="'+s+'#{svgId}"',e=new CKEDITOR.template('<li class="cke_emoji-navigation_item" data-cke-emoji-group="{group}"><a href="#" title="{name}" draggable="false" _cke_focus="1"><svg viewBox="0 0 34 34" aria-labelledby="{svgId}-title"><title id="{svgId}-title">{name}</title><use '+s+"></use></svg></a></li>"),s=t.reduce(this.groups,(function(t,s){return s.items.length?t+e.output({group:i(s.name),name:i(s.sectionName),svgId:i(s.svgId),translateX:s.translate&&s.translate.x?i(s.translate.x):0,translateY:s.translate&&s.translate.y?i(s.translate.y):0}):t}),"")),this.listeners.push({selector:"nav",event:"click",listener:function(e){var i=e.data.getTarget().getAscendant("li",!0);i&&(t.forEach(this.elements.navigationItems.toArray(),(function(e){e.equals(i)?e.addClass("active"):e.removeClass("active")})),this.clearSearchAndMoveFocus(i),e.data.preventDefault())}}),'<nav aria-label="'+i(this.lang.navigationLabel)+'"><ul>'+s+"</ul></nav>"},createSearchSection:function(){return this.listeners.push({selector:"input",event:"input",listener:CKEDITOR.tools.throttle(200,this.filter,this).input}),this.listeners.push({selector:"input",event:"click",listener:function(){this.blockObject._.markItem(this.inputIndex)}}),'<label class="cke_emoji-search">'+this.getLoupeIcon()+'<input placeholder="'+i(this.lang.searchPlaceholder)+'" type="search" aria-label="'+i(this.lang.searchLabel)+'" role="search" _cke_focus="1"></label>'},createEmojiListBlock:function(){return this.listeners.push({selector:".cke_emoji-outer_emoji_block",event:"scroll",listener:CKEDITOR.tools.throttle(150,this.refreshNavigationStatus,this).input}),this.listeners.push({selector:".cke_emoji-outer_emoji_block",event:"click",listener:function(e){e.data.getTarget().data("cke-emoji-name")&&this.editor.execCommand("insertEmoji",{emojiText:e.data.getTarget().data("cke-emoji-symbol")})}}),this.listeners.push({selector:".cke_emoji-outer_emoji_block",event:"mouseover",listener:function(e){this.updateStatusbar(e.data.getTarget())}}),this.listeners.push({selector:".cke_emoji-outer_emoji_block",event:"keyup",listener:function(){this.updateStatusbar(this.items.getItem(this.blockObject._.focusIndex))}}),'<div class="cke_emoji-outer_emoji_block">'+this.getEmojiSections()+"</div>"},createStatusBar:function(){return'<div class="cke_emoji-status_bar"><div class="cke_emoji-status_icon"></div><p class="cke_emoji-status_description"></p><p class="cke_emoji-status_full_name"></p></div>'},getLoupeIcon:function(){var e=CKEDITOR.getUrl(this.plugin.path+"assets/iconsall.svg"),t=CKEDITOR.getUrl(this.plugin.path+"assets/iconsall.png");return CKEDITOR.env.ie&&!CKEDITOR.env.edge?'<span class="cke_emoji-search_loupe" aria-hidden="true" style="background-image:url('+t+');"></span>':'<svg viewBox="0 0 34 34" role="img" aria-hidden="true" class="cke_emoji-search_loupe"><use '+(CKEDITOR.env.safari?'xlink:href="'+e+'#cke4-icon-emoji-10"':'href="'+e+'#cke4-icon-emoji-10"')+"></use></svg>"},getEmojiSections:function(){return t.reduce(this.groups,(function(e,t){return t.items.length?e+this.getEmojiSection(t):e}),"",this)},getEmojiSection:function(e){var t=i(e.name);return'<section data-cke-emoji-group="'+t+'" ><h2 id="'+t+'">'+i(e.sectionName)+"</h2><ul>"+(e=this.getEmojiListGroup(e.items))+"</ul></section>"},getEmojiListGroup:function(e){var s=new CKEDITOR.template('<li class="cke_emoji-item"><a draggable="false" data-cke-emoji-full-name="{id}" data-cke-emoji-name="{name}" data-cke-emoji-symbol="{symbol}" data-cke-emoji-group="{group}" data-cke-emoji-keywords="{keywords}" title="{name}" href="#" _cke_focus="1">{symbol}</a></li>');return t.reduce(e,(function(e,t){return e+s.output({symbol:i(t.symbol),id:i(t.id),name:i(t.id.replace(/::.*$/,":").replace(/^:|:$/g,"").replace(/_/g," ")),group:i(t.group),keywords:i((t.keywords||[]).join(","))})}),"",this)},filter:function(e){var i={},s="string"==typeof e?e:e.sender.getValue();t.forEach(this.elements.emojiItems.toArray(),(function(e){var t;e:{t=e.data("cke-emoji-name");var n=e.data("cke-emoji-keywords");if(-1!==t.indexOf(s))t=!0;else{if(n)for(t=n.split(","),n=0;n<t.length;n++)if(-1!==t[n].indexOf(s)){t=!0;break e}t=!1}}t||""===s?(e.removeClass("hidden"),e.getParent().removeClass("hidden"),i[e.data("cke-emoji-group")]=!0):(e.addClass("hidden"),e.getParent().addClass("hidden"))})),t.forEach(this.elements.sectionHeaders.toArray(),(function(e){i[e.getId()]?(e.getParent().removeClass("hidden"),e.removeClass("hidden")):(e.addClass("hidden"),e.getParent().addClass("hidden"))})),this.refreshNavigationStatus()},clearSearchInput:function(){this.elements.input.setValue(""),this.filter("")},openReset:function(){var e,t=this;return function(){e||(t.filter(""),e=!0),t.elements.emojiBlock.$.scrollTop=0,t.refreshNavigationStatus(),t.clearSearchInput(),CKEDITOR.tools.setTimeout((function(){t.elements.input.focus(!0),t.blockObject._.markItem(t.inputIndex)}),0,t),t.clearStatusbar()}},refreshNavigationStatus:function(){var e,i,s=this.elements.emojiBlock.getClientRect().top;e=t.filter(this.elements.sections.toArray(),(function(e){var t=e.getClientRect();return!(!t.height||e.findOne("h2").hasClass("hidden"))&&t.height+t.top>s})),i=!!e.length&&e[0].data("cke-emoji-group"),t.forEach(this.elements.navigationItems.toArray(),(function(e){e.data("cke-emoji-group")===i?e.addClass("active"):e.removeClass("active")}))},updateStatusbar:function(e){"a"===e.getName()&&e.hasAttribute("data-cke-emoji-name")&&(this.elements.statusIcon.setText(i(e.getText())),this.elements.statusDescription.setText(i(e.data("cke-emoji-name"))),this.elements.statusName.setText(i(e.data("cke-emoji-full-name"))))},clearStatusbar:function(){this.elements.statusIcon.setText(""),this.elements.statusDescription.setText(""),this.elements.statusName.setText("")},clearSearchAndMoveFocus:function(e){this.clearSearchInput(),this.moveFocus(e.data("cke-emoji-group"))},moveFocus:function(e){var t;(e=this.blockElement.findOne('a[data-cke-emoji-group="'+i(e)+'"]'))&&(t=this.getItemIndex(this.items,e),e.focus(!0),e.getAscendant("section").getFirst().scrollIntoView(!0),this.blockObject._.markItem(t))},getItemIndex:function(e,i){return t.indexOf(e.toArray(),(function(e){return e.equals(i)}))},addEmojiToGroups:function(){var e={};t.forEach(this.groups,(function(t){e[t.name]=t.items}),this),t.forEach(this.emojiList,(function(t){e[t.group].push(t)}),this)}}});CKEDITOR.plugins.add("emoji",{requires:"autocomplete,textmatch,ajax,panelbutton,floatpanel",lang:"en",icons:"emojipanel",hidpi:!0,isSupportedEnvironment:function(){return!CKEDITOR.env.ie||11<=CKEDITOR.env.version},beforeInit:function(){this.isSupportedEnvironment()&&!e&&(CKEDITOR.document.appendStyleSheet(this.path+"skins/default.css"),e=!0)},init:function(e){if(this.isSupportedEnvironment()){var t=CKEDITOR.tools.array;CKEDITOR.ajax.load(CKEDITOR.getUrl(e.config.emoji_emojiListUrl||"plugins/emoji/emoji.json"),(function(i){function s(){e._.emoji.autocomplete=new CKEDITOR.plugins.autocomplete(e,{textTestCallback:function(e){return e.collapsed?CKEDITOR.plugins.textMatch.match(e,n):null},dataCallback:o,itemTemplate:'<li data-id="{id}" class="cke_emoji-suggestion_item">{symbol} {id}</li>',outputTemplate:"{symbol}"})}function n(e,t){var i=e.slice(0,t),s=i.match(new RegExp("(?:\\s|^)(:\\S{"+r+"}\\S*)$"));return s?{start:i.lastIndexOf(s[1]),end:t}:null}function o(e,i){var s=e.query.substr(1).toLowerCase(),n=t.filter(a,(function(e){return-1!==e.id.toLowerCase().indexOf(s)})).sort((function(e,t){var i=!e.id.substr(1).indexOf(s);return i!=!t.id.substr(1).indexOf(s)?i?-1:1:e.id>t.id?1:-1}));i(n)}if(null!==i){void 0===e._.emoji&&(e._.emoji={}),void 0===e._.emoji.list&&(e._.emoji.list=JSON.parse(i));var a=e._.emoji.list,r=void 0===e.config.emoji_minChars?2:e.config.emoji_minChars;"ready"!==e.status?e.once("instanceReady",s):s()}})),e.addCommand("insertEmoji",{exec:function(e,t){e.insertHtml(t.emojiText)}}),e.plugins.toolbar&&new s(e,this)}}})}();